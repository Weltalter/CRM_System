<form action="#" id="AddOrder" method="post" enctype="multipart/form-data">
    <div style="font-weight: 700;
                font-size: 16px;
                margin: 10px">
        <p>
            Заполните форму, чтобы добавить новую запись заказа.
        </p>
    </div>
    <div>
        <p>
            <input Placeholder="ID заказчика" tabindex="1" name="ClientID" type="text" class="form_input _req _num" />
        </p>
    </div>
    <div>
        <p>
            <input Placeholder="Описание" tabindex="2" name="Describtion" type="text" class="form_input _req"/>
        </p>
    </div>
    <div>
        <p>
            <input Placeholder="Цена заказа" tabindex="3" name="Price" type="text" class="form_input _req _num" />
        </p>
    </div>
    <div style="font-weight: 700">
        Дата заказа
    </div>
    <div>
        <input tabindex="4" name="OrderDate" type="date" class="form_input _req"/>
    </div>
    <div>
        <button tabindex="5" type="submit" style="float: left">Добавить</button>
        <button tabindex="6" type="reset">Очистить</button>
    </div>
</form>

<script>

    const form = document.getElementById('AddOrder');

    const clientIDInput = document.querySelector('input[name="ClientID"]');
    const describtionInput = document.querySelector('input[name="Describtion"]');
    const priceInput = document.querySelector('input[name="Price"]');
    const orderDateInput = document.querySelector('input[name="OrderDate"]');

    form.addEventListener('submit', function (event) {
        event.preventDefault();

        const clientIDScript = clientIDInput.value;
        const describtionScript = describtionInput.value;
        const priceScript = priceInput.value;
        const orderDateScript = orderDateInput.value;


        console.log('ID клиента:', clientIDScript);
        console.log('Описание:', describtionScript);
        console.log('Цена:', priceScript);
        console.log('Дата заказа:', orderDateScript);

        const order = {
            clientID: clientIDScript,
            desc: describtionScript,
            price: priceScript,
            orderDate: orderDateScript
        };

        let error = formValidate(form);

        if (error === 0) {
            fetch('/JScript/AddOrder', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(order)
            })
                .then((response) => {
                    if (!response.ok) {
                        return response.json().then((error) => {
                            throw new Error(error.error);
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    alert('Заказ успешно добавлен');
                    console.log('Заказ успешно добавлен:');
                    console.log(data);
                    form.reset();
                })
                .catch(error => {
                        alert(error);
                        console.log('Ошибка при добавлении заказа:', error);                                        
                });
        } else {
            alert('Заполните обязательные поля');
        }

        function formValidate(form) {
            let error = 0;
            let formReq = document.querySelectorAll('._req');

            for (let index = 0; index < formReq.length; index++) {
                const input = formReq[index];
                formRemoveError(input);

                if (input.classList.contains('_num')) {
                    if (numTest(input)) {
                        formAddError(input);
                        error++;
                    }
                } else {
                    if (input.value === '') {
                        formAddError(input);
                        error++;
                    }
                }
            }
            return error;
        }

        function formAddError(input) {
            input.parentElement.classList.add('_error');
            input.classList.add('_error');
        }
        function formRemoveError(input) {
            input.parentElement.classList.remove('_error');
            input.classList.remove('_error');
        }
        function numTest(input) {
            return !/^[0-9]+$/.test(input.value);
        }

    });
</script>
