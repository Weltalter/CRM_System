<form action="#" id="AddClient" method="post" enctype="multipart/form-data">
    <div style="font-weight: 700;
                font-size: 16px;
                margin: 10px">
        <p>
            Заполните форму, чтобы добавить новую запись клиента.
        </p>
    </div>
    <div>
        <p>
            <input Placeholder="Фамилия" tabindex="1" name="MiddleName" type="text" class="form_input _req _name" />
        </p>
    </div>
    <div>
        <p>
            <input Placeholder="Имя" tabindex="2" name="FirstName" type="text" class=" form_input _req _name" />
        </p>
    </div>
    <div>
        <p>
            <input Placeholder="Отчество" tabindex="3" name="LastName" type="text" class="form_input _req _name" />
        </p>
    </div>
    <div style="font-weight: 700">
        Дата рождения
    </div>
    <div>
        <input tabindex="4" name="BirthDate" type="date" class="form_input _req" />
    </div>
    <div>
        <button tabindex="5" type="submit" style="float: left">Добавить</button>
        <button tabindex="6" type="reset">Очистить</button>
    </div>
</form>

<script>

    const form = document.getElementById('AddClient');

    const middleNameInput = document.querySelector('input[name="MiddleName"]');
    const firstNameInput = document.querySelector('input[name="FirstName"]');
    const lastNameInput = document.querySelector('input[name="LastName"]');
    const birthDateInput = document.querySelector('input[name="BirthDate"]');

    form.addEventListener('submit', function (event) {
        event.preventDefault();

        const middleNameScript = middleNameInput.value;
        const firstNameScript = firstNameInput.value;
        const lastNameScript = lastNameInput.value;
        const birthDateScript = birthDateInput.value;


        console.log('Фамилия:', middleNameScript);
        console.log('Имя:', firstNameScript);
        console.log('Отчество:', lastNameScript);
        console.log('Дата рождения:', birthDateScript);

        const client = {
            firstName: firstNameScript,
            middleName: middleNameScript,
            lastName: lastNameScript,
            birthdate: birthDateScript
        };

        let error = formValidate(form);

        if(error ===0){
            fetch('/JScript/AddClient', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(client)
            })
                .then((response) => {
                    if (!response.ok) {
                        return response.json().then((error) => {
                            throw new Error(error.error);
                        });
                    }
                    return response.json();
                })
                .then(data => {
                    alert('Клиент успешно добавлен')
                    console.log('Клиент успешно добавлен:');
                    console.log(data);
                    form.reset();
                })
                .catch(error => {
                    alert(error)
                    console.log('Ошибка при добавлении клиента:');
                    console.error(error);
                });
        } else{
            alert('Заполните обязательные поля');
        }

        function formValidate(form){
            let error = 0;
            let formReq = document.querySelectorAll('._req');

            for(let index = 0; index < formReq.length; index++){
                    const input = formReq[index];
                    formRemoveError(input);

                    if(input.classList.contains('_name')){
                        if (nameTest(input)){
                            formAddError(input);
                            error++;
                        }
                    } else{
                        if (input.value === ''){
                            formAddError(input);
                            error++;
                        }
                    }
            }
            return error;
        }

        function formAddError(input){
            input.parentElement.classList.add('_error');
            input.classList.add('_error');
        }
        function formRemoveError(input) {
            input.parentElement.classList.remove('_error');
            input.classList.remove('_error');
        }
        function nameTest(input){
            return !/^[a-zA-Zа-яА-ЯёЁ]+$/.test(input.value);
        }
    });
</script>